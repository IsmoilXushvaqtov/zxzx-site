<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IdeaFlow Ultimate - Premium Loyiha Boshqaruvi</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600&display=swap');

        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f9fa;
            --bg-tertiary: #e9ecef;
            --bg-hover: #dee2e6;
            --text-primary: #212529;
            --text-secondary: #6c757d;
            --text-muted: #adb5bd;
            --border: #dee2e6;
            --accent: #0d6efd;
            --accent-hover: #0b5ed7;
            --accent-light: rgba(13, 110, 253, 0.1);
            --success: #198754;
            --success-light: rgba(25, 135, 84, 0.1);
            --danger: #dc3545;
            --danger-light: rgba(220, 53, 69, 0.1);
            --warning: #ffc107;
            --warning-light: rgba(255, 193, 7, 0.1);
            --info: #0dcaf0;
            --info-light: rgba(13, 202, 240, 0.1);
            --purple: #6f42c1;
            --purple-light: rgba(111, 66, 193, 0.1);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 24px rgba(0,0,0,0.15);
            --shadow-xl: 0 16px 48px rgba(0,0,0,0.2);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 14px;
            --radius-xl: 18px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body.dark-mode {
            --bg-primary: #0d1117;
            --bg-secondary: #161b22;
            --bg-tertiary: #21262d;
            --bg-hover: #30363d;
            --text-primary: #e6edf3;
            --text-secondary: #8b949e;
            --text-muted: #6e7681;
            --border: #30363d;
            --accent: #1f6feb;
            --accent-hover: #388bfd;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            transition: var(--transition);
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 320px;
            height: 100vh;
            background: var(--bg-secondary);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            z-index: 1000;
            transition: var(--transition);
        }

        .sidebar.collapsed {
            width: 70px;
        }

        .sidebar-header {
            padding: 20px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
        }

        .logo {
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent), var(--purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .logo-icon {
            font-size: 28px;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        .sidebar.collapsed .logo-text {
            display: none;
        }

        .toggle-sidebar {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 18px;
        }

        .toggle-sidebar:hover {
            background: var(--bg-hover);
            transform: scale(1.05);
        }

        .sidebar-stats {
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .sidebar.collapsed .sidebar-stats {
            display: none;
        }

        .stat-card {
            text-align: center;
            padding: 10px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--accent);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .sidebar-tabs {
            display: flex;
            gap: 5px;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar.collapsed .sidebar-tabs {
            padding: 15px 10px;
            flex-direction: column;
        }

        .tab-btn {
            flex: 1;
            padding: 8px 12px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            font-size: 13px;
        }

        .tab-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
        }

        .sidebar.collapsed .tab-btn {
            font-size: 18px;
            padding: 10px;
        }

        .sidebar-controls {
            padding: 15px 20px;
            display: flex;
            gap: 10px;
            border-bottom: 1px solid var(--border);
        }

        .sidebar.collapsed .sidebar-controls {
            flex-direction: column;
            padding: 15px 10px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: var(--radius-md);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
            font-family: inherit;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
            flex: 1;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-hover);
        }

        .sidebar.collapsed .btn span:not(.btn-icon) {
            display: none;
        }

        .sections-container {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
        }

        .sections-container::-webkit-scrollbar {
            width: 6px;
        }

        .sections-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .sections-container::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 3px;
        }

        .sections-container::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        .section-item {
            margin-bottom: 10px;
            border-radius: var(--radius-lg);
            background: var(--bg-primary);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .section-item:hover {
            box-shadow: var(--shadow-sm);
            border-color: var(--accent);
        }

        .section-header {
            padding: 14px 16px;
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: var(--transition);
        }

        .section-icon {
            font-size: 20px;
            transition: var(--transition);
        }

        .section-item.collapsed .section-icon {
            transform: rotate(-90deg);
        }

        .section-name {
            flex: 1;
            font-weight: 600;
            font-size: 14px;
        }

        .section-count {
            background: var(--accent-light);
            color: var(--accent);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
        }

        .section-actions {
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: var(--transition);
        }

        .section-header:hover .section-actions {
            opacity: 1;
        }

        .icon-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--bg-tertiary);
            cursor: pointer;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 14px;
        }

        .icon-btn:hover {
            background: var(--bg-hover);
            transform: scale(1.1);
        }

        .pages-list {
            padding: 0 10px 10px 10px;
            display: none;
        }

        .section-item:not(.collapsed) .pages-list {
            display: block;
        }

        .page-item {
            padding: 10px 14px;
            margin: 4px 0;
            border-radius: var(--radius-md);
            cursor: move;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: var(--transition);
            background: var(--bg-secondary);
            border: 1px solid transparent;
        }

        .page-item:hover {
            background: var(--bg-tertiary);
            border-color: var(--border);
        }

        .page-item.active {
            background: var(--accent-light);
            border-color: var(--accent);
        }

        .page-item.sortable-ghost {
            opacity: 0.4;
        }

        .page-item.sortable-drag {
            box-shadow: var(--shadow-lg);
        }

        .page-icon {
            font-size: 16px;
        }

        .page-name {
            flex: 1;
            font-size: 13px;
            font-weight: 500;
        }

        .page-tags {
            display: flex;
            gap: 4px;
        }

        .tag {
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            background: var(--success-light);
            color: var(--success);
        }

        .tag.priority-high {
            background: var(--danger-light);
            color: var(--danger);
        }

        .tag.priority-medium {
            background: var(--warning-light);
            color: var(--warning);
        }

        .page-actions {
            display: flex;
            gap: 3px;
            opacity: 0;
            transition: var(--transition);
        }

        .page-item:hover .page-actions,
        .page-item.active .page-actions {
            opacity: 1;
        }

        /* Main Container */
        .main-container {
            margin-left: 320px;
            min-height: 100vh;
            transition: var(--transition);
        }

        .sidebar.collapsed + .main-container {
            margin-left: 70px;
        }

        .top-bar {
            height: 70px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 30px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .page-header {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .page-title {
            font-size: 26px;
            font-weight: 800;
            background: linear-gradient(135deg, var(--text-primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-meta {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .meta-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
        }

        .top-bar-actions {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .search-box {
            position: relative;
        }

        .search-input {
            padding: 10px 40px 10px 40px;
            border: 1px solid var(--border);
            border-radius: var(--radius-lg);
            background: var(--bg-primary);
            color: var(--text-primary);
            width: 280px;
            transition: var(--transition);
            font-family: inherit;
            font-size: 14px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px var(--accent-light);
            width: 350px;
        }

        .search-icon {
            position: absolute;
            left: 14px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            color: var(--text-secondary);
        }

        .view-toggle {
            display: flex;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            padding: 4px;
        }

        .view-btn {
            padding: 6px 12px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            font-size: 16px;
        }

        .view-btn:hover {
            color: var(--text-primary);
        }

        .view-btn.active {
            background: var(--bg-primary);
            color: var(--accent);
            box-shadow: var(--shadow-sm);
        }

        .theme-toggle {
            width: 40px;
            height: 40px;
            border: 1px solid var(--border);
            background: var(--bg-primary);
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            font-size: 18px;
        }

        .theme-toggle:hover {
            background: var(--bg-tertiary);
            transform: rotate(20deg);
        }

        .content-area {
            padding: 30px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .empty-state {
            text-align: center;
            padding: 80px 20px;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .empty-state h2 {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .empty-state p {
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 25px;
        }

        /* Content Blocks */
        .content-block {
            margin-bottom: 25px;
            position: relative;
            border-radius: var(--radius-xl);
            transition: var(--transition);
            background: var(--bg-secondary);
            border: 2px solid transparent;
            overflow: hidden;
        }

        .content-block:hover {
            border-color: var(--border);
            box-shadow: var(--shadow-md);
        }

        .content-block.focused {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px var(--accent-light);
        }

        .content-block.sortable-ghost {
            opacity: 0.4;
        }

        .block-handle {
            position: absolute;
            left: 10px;
            top: 10px;
            width: 24px;
            height: 24px;
            cursor: move;
            opacity: 0;
            transition: var(--transition);
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .content-block:hover .block-handle {
            opacity: 1;
        }

        .block-toolbar {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 6px;
            opacity: 0;
            transition: var(--transition);
            background: var(--bg-primary);
            padding: 6px;
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            z-index: 10;
        }

        .content-block:hover .block-toolbar {
            opacity: 1;
        }

        .toolbar-btn {
            width: 32px;
            height: 32px;
            border: none;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
        }

        .toolbar-btn:hover {
            background: var(--accent);
            color: white;
            transform: scale(1.1);
        }

        .block-content {
            padding: 25px;
            min-height: 80px;
            outline: none;
            font-size: 15px;
            line-height: 1.8;
        }

        .block-heading {
            font-size: 36px;
            font-weight: 800;
            padding: 30px;
            outline: none;
            line-height: 1.3;
        }

        .block-heading[contenteditable="true"]:empty:before {
            content: "‚ú® Sarlavha kiriting...";
            color: var(--text-muted);
            font-weight: 600;
        }

        .block-text[contenteditable="true"]:empty:before {
            content: "üìù Matn kiriting... (Markdown qo'llab-quvvatlanadi: **qalin**, *kursiv*, # sarlavha)";
            color: var(--text-muted);
        }

        .block-text h1, .block-text h2, .block-text h3 {
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .block-text ul, .block-text ol {
            margin-left: 25px;
            margin-top: 10px;
        }

        .block-text code {
            background: var(--bg-tertiary);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 13px;
        }

        .block-list {
            padding: 25px;
            outline: none;
        }

        .block-list[contenteditable="true"]:empty:before {
            content: "üìã Ro'yxat elementlarini kiriting...\n‚Ä¢ Element 1\n‚Ä¢ Element 2\n‚Ä¢ Element 3";
            color: var(--text-muted);
            white-space: pre;
        }

        .block-code {
            font-family: 'JetBrains Mono', monospace;
            font-size: 14px;
            padding: 25px;
            outline: none;
            overflow-x: auto;
            line-height: 1.6;
        }

        .block-code[contenteditable="true"]:empty:before {
            content: "// üíª Kod kiriting...\nfunction hello() {\n    console.log('Hello, World!');\n}";
            color: var(--text-muted);
            white-space: pre;
        }

        .block-quote {
            border-left: 5px solid var(--accent);
            padding: 25px 25px 25px 35px;
            background: var(--accent-light);
            font-style: italic;
            outline: none;
            font-size: 16px;
        }

        .block-quote[contenteditable="true"]:empty:before {
            content: "üí¨ Muhim iqtibos yoki eslatma...";
            color: var(--text-muted);
        }

        .block-checklist {
            padding: 25px;
            outline: none;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            margin-bottom: 8px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            transition: var(--transition);
        }

        .checklist-item:hover {
            background: var(--bg-hover);
        }

        .checklist-checkbox {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 6px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .checklist-checkbox.checked {
            background: var(--success);
            border-color: var(--success);
        }

        .checklist-checkbox.checked::after {
            content: "‚úì";
            color: white;
            font-size: 14px;
            font-weight: bold;
        }

        .checklist-text {
            flex: 1;
            outline: none;
        }

        .checklist-text.completed {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .block-image {
            min-height: 250px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px dashed var(--border);
            border-radius: var(--radius-lg);
            margin: 25px;
            transition: var(--transition);
            background: var(--bg-tertiary);
        }

        .block-image:hover {
            border-color: var(--accent);
            background: var(--accent-light);
        }

        .block-image img {
            max-width: 100%;
            border-radius: var(--radius-lg);
        }

        .image-placeholder {
            text-align: center;
            color: var(--text-secondary);
        }

        .image-placeholder-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .block-table {
            padding: 25px;
            overflow-x: auto;
        }

        .block-table table {
            width: 100%;
            border-collapse: collapse;
            border-radius: var(--radius-md);
            overflow: hidden;
        }

        .block-table th,
        .block-table td {
            border: 1px solid var(--border);
            padding: 12px 15px;
            text-align: left;
        }

        .block-table th {
            background: var(--accent);
            color: white;
            font-weight: 600;
        }

        .block-table tr:hover {
            background: var(--bg-tertiary);
        }

        .block-divider {
            height: 3px;
            background: linear-gradient(90deg, transparent, var(--accent), transparent);
            margin: 30px 25px;
            border-radius: 2px;
        }

        /* Floating Menu */
        .floating-menu {
            position: fixed;
            bottom: 35px;
            right: 35px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            z-index: 1000;
        }

        .fab {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--purple));
            color: white;
            border: none;
            font-size: 28px;
            cursor: pointer;
            box-shadow: var(--shadow-xl);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: scale(1.1) rotate(90deg);
            box-shadow: 0 8px 32px rgba(13, 110, 253, 0.4);
        }

        .fab-menu {
            display: none;
            flex-direction: column;
            gap: 12px;
        }

        .fab-menu.active {
            display: flex;
            animation: fadeInUp 0.3s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fab-item {
            display: flex;
            align-items: center;
            gap: 12px;
            background: var(--bg-secondary);
            padding: 14px 20px;
            border-radius: var(--radius-xl);
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            white-space: nowrap;
            border: 1px solid var(--border);
        }

        .fab-item:hover {
            background: var(--accent);
            color: white;
            transform: translateX(-8px) scale(1.05);
            border-color: var(--accent);
        }

        .fab-item-icon {
            font-size: 22px;
        }

        .fab-item-text {
            font-weight: 600;
            font-size: 14px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--radius-xl);
            width: 92%;
            max-width: 850px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: modalSlideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border);
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px) scale(0.95);
                opacity: 0;
            }
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .modal-header {
            padding: 28px 35px;
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--bg-secondary);
        }

        .modal-title {
            font-size: 26px;
            font-weight: 800;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .close-modal {
            width: 38px;
            height: 38px;
            border: none;
            background: var(--bg-tertiary);
            font-size: 20px;
            cursor: pointer;
            color: var(--text-secondary);
            border-radius: var(--radius-md);
            transition: var(--transition);
        }

        .close-modal:hover {
            background: var(--danger);
            color: white;
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 35px;
        }

        .help-section {
            margin-bottom: 35px;
        }

        .help-section h3 {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 18px;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .shortcut-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 12px;
        }

        .shortcut-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 14px 18px;
            background: var(--bg-secondary);
            border-radius: var(--radius-md);
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .shortcut-item:hover {
            border-color: var(--accent);
            box-shadow: var(--shadow-sm);
        }

        .shortcut-desc {
            font-weight: 500;
        }

        .shortcut-key {
            background: var(--bg-tertiary);
            padding: 6px 14px;
            border-radius: var(--radius-sm);
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            font-size: 12px;
            border: 1px solid var(--border);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 18px;
        }

        .feature-card {
            padding: 24px;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            text-align: center;
            border: 1px solid var(--border);
            transition: var(--transition);
        }

        .feature-card:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }

        .feature-icon {
            font-size: 40px;
            margin-bottom: 12px;
        }

        .feature-title {
            font-weight: 700;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .feature-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Save Indicator */
        .save-indicator {
            position: fixed;
            bottom: 35px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 24px;
            background: var(--success);
            color: white;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-lg);
            opacity: 0;
            transition: var(--transition);
            pointer-events: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .save-indicator.show {
            opacity: 1;
        }

        /* Kanban View */
        .kanban-board {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px 0;
        }

        .kanban-column {
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 20px;
            border: 1px solid var(--border);
        }

        .kanban-header {
            font-weight: 700;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .kanban-card {
            background: var(--bg-primary);
            padding: 15px;
            border-radius: var(--radius-md);
            margin-bottom: 12px;
            border: 1px solid var(--border);
            cursor: move;
            transition: var(--transition);
        }

        .kanban-card:hover {
            box-shadow: var(--shadow-md);
            border-color: var(--accent);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
            }
            
            .main-container {
                margin-left: 70px;
            }

            .search-input {
                width: 180px;
            }

            .top-bar {
                padding: 0 15px;
            }

            .content-area {
                padding: 15px;
            }

            .floating-menu {
                bottom: 20px;
                right: 20px;
            }

            .fab {
                width: 56px;
                height: 56px;
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="logo">
                <span class="logo-icon">üöÄ</span>
                <span class="logo-text">IdeaFlow Ultimate</span>
            </div>
            <button class="toggle-sidebar" onclick="toggleSidebar()">‚ò∞</button>
        </div>

        <div class="sidebar-stats">
            <div class="stat-card">
                <div class="stat-value" id="statSections">0</div>
                <div class="stat-label">Bo'limlar</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statPages">0</div>
                <div class="stat-label">Sahifalar</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="statBlocks">0</div>
                <div class="stat-label">Bloklar</div>
            </div>
        </div>

        <div class="sidebar-tabs">
            <button class="tab-btn active" onclick="switchTab('tree')" data-tab="tree">üìÅ</button>
            <button class="tab-btn" onclick="switchTab('kanban')" data-tab="kanban">üìã</button>
            <button class="tab-btn" onclick="switchTab('calendar')" data-tab="calendar">üìÖ</button>
        </div>

        <div class="sidebar-controls">
            <button class="btn btn-primary" onclick="createSection()">
                <span class="btn-icon">‚ûï</span>
                <span>Bo'lim</span>
            </button>
            <button class="btn btn-secondary" onclick="createPage()">
                <span class="btn-icon">üìÑ</span>
                <span>Sahifa</span>
            </button>
        </div>

        <div class="sections-container" id="sectionsContainer"></div>
    </div>

    <div class="main-container">
        <div class="top-bar">
            <div class="page-header">
                <div class="page-title" id="pageTitle">IdeaFlow Ultimate</div>
                <div class="page-meta">
                    <span class="meta-badge" id="lastModified">Yangi</span>
                    <span class="meta-badge" id="wordCount">0 so'z</span>
                </div>
            </div>
            <div class="top-bar-actions">
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" placeholder="Qidirish..." id="searchInput">
                </div>
                <div class="view-toggle">
                    <button class="view-btn active" onclick="switchView('edit')" title="Tahrirlash">‚úèÔ∏è</button>
                    <button class="view-btn" onclick="switchView('preview')" title="Ko'rish">üëÅÔ∏è</button>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
                <button class="btn btn-secondary" onclick="exportData()">üíæ</button>
                <button class="btn btn-secondary" onclick="showHelp()">‚ùì</button>
            </div>
        </div>

        <div class="content-area" id="contentArea">
            <div class="empty-state">
                <div class="empty-state-icon">üé®</div>
                <h2>Professional Loyiha Boshqaruvi</h2>
                <p>Yangi bo'lim yarating va g'oyalaringizni hujjatlang<br>Yordam uchun <strong>H</strong> bosing</p>
                <button class="btn btn-primary" onclick="createSection()">üöÄ Boshlash</button>
            </div>
        </div>
    </div>

    <div class="floating-menu">
        <div class="fab-menu" id="fabMenu">
            <div class="fab-item" onclick="addBlock('heading')">
                <span class="fab-item-icon">üìå</span>
                <span class="fab-item-text">Sarlavha</span>
            </div>
            <div class="fab-item" onclick="addBlock('text')">
                <span class="fab-item-icon">üìù</span>
                <span class="fab-item-text">Matn</span>
            </div>
            <div class="fab-item" onclick="addBlock('list')">
                <span class="fab-item-icon">üìã</span>
                <span class="fab-item-text">Ro'yxat</span>
            </div>
            <div class="fab-item" onclick="addBlock('checklist')">
                <span class="fab-item-icon">‚úÖ</span>
                <span class="fab-item-text">Chek-list</span>
            </div>
            <div class="fab-item" onclick="addBlock('code')">
                <span class="fab-item-icon">üíª</span>
                <span class="fab-item-text">Kod</span>
            </div>
            <div class="fab-item" onclick="addBlock('quote')">
                <span class="fab-item-icon">üí¨</span>
                <span class="fab-item-text">Iqtibos</span>
            </div>
            <div class="fab-item" onclick="addBlock('image')">
                <span class="fab-item-icon">üñºÔ∏è</span>
                <span class="fab-item-text">Rasm</span>
            </div>
            <div class="fab-item" onclick="addBlock('table')">
                <span class="fab-item-icon">üìä</span>
                <span class="fab-item-text">Jadval</span>
            </div>
            <div class="fab-item" onclick="addBlock('divider')">
                <span class="fab-item-icon">‚ûñ</span>
                <span class="fab-item-text">Ajratuvchi</span>
            </div>
        </div>
        <button class="fab" onclick="toggleFabMenu()">+</button>
    </div>

    <div class="modal" id="helpModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title"><span>üìö</span> Qo'llanma va Yordam</h2>
                <button class="close-modal" onclick="closeHelp()">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h3><span>‚å®Ô∏è</span> Klaviatura Yorliqlari</h3>
                    <div class="shortcut-grid">
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Yordam</span>
                            <span class="shortcut-key">H</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Yangi bo'lim</span>
                            <span class="shortcut-key">Shift + T</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Yangi sahifa</span>
                            <span class="shortcut-key">T</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Matn qo'shish</span>
                            <span class="shortcut-key">W</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Kod qo'shish</span>
                            <span class="shortcut-key">C</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Rasm qo'shish</span>
                            <span class="shortcut-key">P</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Ro'yxat qo'shish</span>
                            <span class="shortcut-key">L</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Chek-list qo'shish</span>
                            <span class="shortcut-key">K</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Qidiruv</span>
                            <span class="shortcut-key">Ctrl + F</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Saqlash</span>
                            <span class="shortcut-key">Ctrl + S</span>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3><span>‚ú®</span> Premium Xususiyatlar</h3>
                    <div class="feature-grid">
                        <div class="feature-card">
                            <div class="feature-icon">üé®</div>
                            <div class="feature-title">Zamonaviy Dizayn</div>
                            <div class="feature-desc">Professional va chiroyli interfeys</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üîÑ</div>
                            <div class="feature-title">Drag & Drop</div>
                            <div class="feature-desc">Bloklar va sahifalarni sudrab tartibla</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üìù</div>
                            <div class="feature-title">Markdown Support</div>
                            <div class="feature-desc">**qalin**, *kursiv*, `kod` va boshqalar</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üíª</div>
                            <div class="feature-title">Syntax Highlighting</div>
                            <div class="feature-desc">Kod bloklari uchun rang ajratish</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üíæ</div>
                            <div class="feature-title">Auto-Save</div>
                            <div class="feature-desc">Avtomatik saqlash tizimi</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üåì</div>
                            <div class="feature-title">Dark Mode</div>
                            <div class="feature-desc">Tungi rejim qo'llab-quvvatlanadi</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">‚úÖ</div>
                            <div class="feature-title">Chek-listlar</div>
                            <div class="feature-desc">Vazifalar ro'yxatini yarating</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üìä</div>
                            <div class="feature-title">Statistika</div>
                            <div class="feature-desc">Bo'lim, sahifa va bloklar soni</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üîç</div>
                            <div class="feature-title">Qidiruv</div>
                            <div class="feature-desc">Tez va kuchli qidiruv tizimi</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üì§</div>
                            <div class="feature-title">Export/Import</div>
                            <div class="feature-desc">JSON formatda saqlash</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">üì±</div>
                            <div class="feature-title">Responsive</div>
                            <div class="feature-desc">Barcha qurilmalarda ishlaydi</div>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">‚ö°</div>
                            <div class="feature-title">Tezkor</div>
                            <div class="feature-desc">Yuqori samaradorlik va tezlik</div>
                        </div>
                    </div>
                </div>

                <div class="help-section">
                    <h3><span>üí°</span> Markdown Qo'llanma</h3>
                    <div class="shortcut-grid">
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Qalin matn</span>
                            <span class="shortcut-key">**matn**</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Kursiv matn</span>
                            <span class="shortcut-key">*matn*</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Sarlavha 1</span>
                            <span class="shortcut-key"># Sarlavha</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Sarlavha 2</span>
                            <span class="shortcut-key">## Sarlavha</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Kod</span>
                            <span class="shortcut-key">`kod`</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-desc">Havola</span>
                            <span class="shortcut-key">[matn](url)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="save-indicator" id="saveIndicator">
        <span>‚úì</span>
        <span>Saqlandi</span>
    </div>

    <script>
        let data = {
            sections: [],
            currentSection: null,
            currentPage: null,
            theme: 'light',
            viewMode: 'tree'
        };

        let saveTimeout;
        let fabMenuOpen = false;
        let blockSortable, pageSortable;

        function init() {
            loadData();
            setupEventListeners();
            setupDragDrop();
            render();
            updateStats();
        }

        function loadData() {
            const saved = localStorage.getItem('ideaflow-ultimate');
            if (saved) {
                try {
                    data = JSON.parse(saved);
                    applyTheme();
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            }
        }

        function saveData() {
            try {
                localStorage.setItem('ideaflow-ultimate', JSON.stringify(data));
                showSaveIndicator();
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        function autoSave() {
            clearTimeout(saveTimeout);
            saveTimeout = setTimeout(() => {
                saveData();
                updateStats();
                updateMetadata();
            }, 800);
        }

        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => indicator.classList.remove('show'), 2000);
        }

        function setupEventListeners() {
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    saveData();
                    return;
                }

                if (e.target.tagName === 'INPUT' || 
                    e.target.tagName === 'TEXTAREA' || 
                    e.target.isContentEditable) {
                    return;
                }

                switch(e.key.toLowerCase()) {
                    case 'h':
                        if (!e.shiftKey) {
                            showHelp();
                        }
                        break;
                    case 't':
                        e.preventDefault();
                        if (e.shiftKey) {
                            createSection();
                        } else {
                            createPage();
                        }
                        break;
                    case 'w':
                        e.preventDefault();
                        addBlock('text');
                        break;
                    case 'l':
                        e.preventDefault();
                        addBlock('list');
                        break;
                    case 'k':
                        e.preventDefault();
                        addBlock('checklist');
                        break;
                    case 'c':
                        e.preventDefault();
                        addBlock('code');
                        break;
                    case 'p':
                        e.preventDefault();
                        addBlock('image');
                        break;
                }
            });

            document.getElementById('helpModal').addEventListener('click', (e) => {
                if (e.target.id === 'helpModal') {
                    closeHelp();
                }
            });
        }

        function setupDragDrop() {
            setTimeout(() => {
                const contentArea = document.getElementById('contentArea');
                if (contentArea && !contentArea.classList.contains('empty-state')) {
                    blockSortable = new Sortable(contentArea, {
                        animation: 200,
                        handle: '.block-handle',
                        ghostClass: 'sortable-ghost',
                        dragClass: 'sortable-drag',
                        onEnd: function() {
                            const blocks = contentArea.children;
                            const newOrder = [];
                            for (let block of blocks) {
                                const blockId = parseInt(block.dataset.blockId);
                                const found = data.currentPage.blocks.find(b => b.id === blockId);
                                if (found) newOrder.push(found);
                            }
                            data.currentPage.blocks = newOrder;
                            autoSave();
                        }
                    });
                }
            }, 100);
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('collapsed');
        }

        function toggleTheme() {
            data.theme = data.theme === 'light' ? 'dark' : 'light';
            applyTheme();
            saveData();
        }

        function applyTheme() {
            if (data.theme === 'dark') {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }

        function showHelp() {
            document.getElementById('helpModal').classList.add('active');
        }

        function closeHelp() {
            document.getElementById('helpModal').classList.remove('active');
        }

        function toggleFabMenu() {
            fabMenuOpen = !fabMenuOpen;
            document.getElementById('fabMenu').classList.toggle('active');
        }

        function switchTab(tab) {
            data.viewMode = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            render();
        }

        function switchView(view) {
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function createSection() {
            const name = prompt('Bo\'lim nomi:');
            if (!name) return;

            const section = {
                id: Date.now(),
                name: name,
                pages: [],
                collapsed: false
            };

            data.sections.push(section);
            data.currentSection = section;
            autoSave();
            render();
        }

        function createPage() {
            if (!data.currentSection) {
                alert('Avval bo\'lim yarating!');
                return;
            }

            const name = prompt('Sahifa nomi:');
            if (!name) return;

            const page = {
                id: Date.now(),
                name: name,
                blocks: [],
                created: new Date().toISOString(),
                modified: new Date().toISOString()
            };

            data.currentSection.pages.push(page);
            data.currentPage = page;
            autoSave();
            render();
        }

        function editSectionName(section) {
            const newName = prompt('Yangi nom:', section.name);
            if (newName && newName !== section.name) {
                section.name = newName;
                autoSave();
                render();
            }
        }

        function toggleSection(sectionId) {
            const section = data.sections.find(s => s.id === sectionId);
            if (section) {
                section.collapsed = !section.collapsed;
                render();
            }
        }

        function editPageName(page) {
            const newName = prompt('Yangi nom:', page.name);
            if (newName && newName !== page.name) {
                page.name = newName;
                page.modified = new Date().toISOString();
                autoSave();
                render();
            }
        }

        function deleteSection(sectionId) {
            if (!confirm('Bu bo\'limni o\'chirmoqchimisiz?')) return;
            
            data.sections = data.sections.filter(s => s.id !== sectionId);
            if (data.currentSection && data.currentSection.id === sectionId) {
                data.currentSection = null;
                data.currentPage = null;
            }
            autoSave();
            render();
        }

        function deletePage(pageId) {
            if (!confirm('Bu sahifani o\'chirmoqchimisiz?')) return;
            
            if (data.currentSection) {
                data.currentSection.pages = data.currentSection.pages.filter(p => p.id !== pageId);
                if (data.currentPage && data.currentPage.id === pageId) {
                    data.currentPage = null;
                }
            }
            autoSave();
            render();
        }

        function selectPage(sectionId, pageId) {
            data.currentSection = data.sections.find(s => s.id === sectionId);
            data.currentPage = data.currentSection.pages.find(p => p.id === pageId);
            autoSave();
            render();
            setupDragDrop();
        }

        function addBlock(type) {
            if (!data.currentPage) {
                alert('Avval sahifa yarating!');
                return;
            }

            const block = {
                id: Date.now(),
                type: type,
                content: type === 'table' ? generateDefaultTable() : 
                        type === 'checklist' ? generateDefaultChecklist() : '',
                created: new Date().toISOString()
            };

            data.currentPage.blocks.push(block);
            data.currentPage.modified = new Date().toISOString();
            autoSave();
            render();
            setupDragDrop();

            if (fabMenuOpen) {
                toggleFabMenu();
            }
        }

        function generateDefaultTable() {
            return '<table><thead><tr><th>Ustun 1</th><th>Ustun 2</th><th>Ustun 3</th></tr></thead><tbody><tr><td>Ma\'lumot 1</td><td>Ma\'lumot 2</td><td>Ma\'lumot 3</td></tr><tr><td>Ma\'lumot 4</td><td>Ma\'lumot 5</td><td>Ma\'lumot 6</td></tr></tbody></table>';
        }

        function generateDefaultChecklist() {
            return JSON.stringify([
                { text: 'Birinchi vazifa', checked: false },
                { text: 'Ikkinchi vazifa', checked: false },
                { text: 'Uchinchi vazifa', checked: false }
            ]);
        }

        function deleteBlock(blockId) {
            if (!confirm('Bu blokni o\'chirmoqchimisiz?')) return;
            
            if (data.currentPage) {
                data.currentPage.blocks = data.currentPage.blocks.filter(b => b.id !== blockId);
                data.currentPage.modified = new Date().toISOString();
                autoSave();
                render();
            }
        }

        function duplicateBlock(blockId) {
            const block = data.currentPage.blocks.find(b => b.id === blockId);
            if (block) {
                const newBlock = { ...block, id: Date.now() };
                const index = data.currentPage.blocks.findIndex(b => b.id === blockId);
                data.currentPage.blocks.splice(index + 1, 0, newBlock);
                autoSave();
                render();
            }
        }

        function uploadImage(blockId) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const block = data.currentPage.blocks.find(b => b.id === blockId);
                        if (block) {
                            block.content = event.target.result;
                            data.currentPage.modified = new Date().toISOString();
                            autoSave();
                            render();
                        }
                    };
                    reader.readAsDataURL(file);
                }
            };
            input.click();
        }

        function updateBlockContent(blockId, content) {
            const block = data.currentPage.blocks.find(b => b.id === blockId);
            if (block) {
                block.content = content;
                data.currentPage.modified = new Date().toISOString();
                autoSave();
            }
        }

        function toggleChecklistItem(blockId, itemIndex) {
            const block = data.currentPage.blocks.find(b => b.id === blockId);
            if (block && block.type === 'checklist') {
                const items = JSON.parse(block.content);
                items[itemIndex].checked = !items[itemIndex].checked;
                block.content = JSON.stringify(items);
                data.currentPage.modified = new Date().toISOString();
                autoSave();
                render();
            }
        }

        function exportData() {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `ideaflow-ultimate-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }

        function updateStats() {
            const totalPages = data.sections.reduce((sum, s) => sum + s.pages.length, 0);
            const totalBlocks = data.sections.reduce((sum, s) => 
                sum + s.pages.reduce((psum, p) => psum + p.blocks.length, 0), 0);
            
            document.getElementById('statSections').textContent = data.sections.length;
            document.getElementById('statPages').textContent = totalPages;
            document.getElementById('statBlocks').textContent = totalBlocks;
        }

        function updateMetadata() {
            if (data.currentPage) {
                const modified = new Date(data.currentPage.modified);
                document.getElementById('lastModified').textContent = 
                    modified.toLocaleDateString('uz-UZ');
                
                const text = data.currentPage.blocks
                    .filter(b => ['text', 'heading', 'list', 'quote'].includes(b.type))
                    .map(b => b.content)
                    .join(' ');
                const words = text.split(/\s+/).filter(w => w.length > 0).length;
                document.getElementById('wordCount').textContent = `${words} so'z`;
            }
        }

        function render() {
            renderSidebar();
            renderContent();
            updateStats();
            updateMetadata();
        }

        function renderSidebar() {
            const container = document.getElementById('sectionsContainer');
            container.innerHTML = '';

            data.sections.forEach(section => {
                const sectionEl = document.createElement('div');
                sectionEl.className = 'section-item' + (section.collapsed ? ' collapsed' : '');
                
                sectionEl.innerHTML = `
                    <div class="section-header">
                        <span class="section-icon" onclick="toggleSection(${section.id})">üìÅ</span>
                        <span class="section-name" onclick="editSectionName(data.sections.find(s => s.id === ${section.id}))">${section.name}</span>
                        <span class="section-count">${section.pages.length}</span>
                        <div class="section-actions">
                            <button class="icon-btn" onclick="event.stopPropagation(); deleteSection(${section.id})" title="O'chirish">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="pages-list" id="pages-${section.id}"></div>
                `;

                container.appendChild(sectionEl);

                const pagesList = document.getElementById(`pages-${section.id}`);
                section.pages.forEach(page => {
                    const pageEl = document.createElement('div');
                    pageEl.className = 'page-item';
                    if (data.currentPage && data.currentPage.id === page.id) {
                        pageEl.classList.add('active');
                    }
                    
                    pageEl.innerHTML = `
                        <span class="page-icon">üìÑ</span>
                        <span class="page-name" onclick="selectPage(${section.id}, ${page.id})">${page.name}</span>
                        <div class="page-actions">
                            <button class="icon-btn" onclick="event.stopPropagation(); editPageName(data.currentSection.pages.find(p => p.id === ${page.id}))" title="Tahrirlash">‚úèÔ∏è</button>
                            <button class="icon-btn" onclick="event.stopPropagation(); deletePage(${page.id})" title="O'chirish">üóëÔ∏è</button>
                        </div>
                    `;
                    
                    pagesList.appendChild(pageEl);
                });

                if (pagesList.children.length > 0 && !section.collapsed) {
                    new Sortable(pagesList, {
                        animation: 200,
                        ghostClass: 'sortable-ghost',
                        onEnd: function() {
                            const newOrder = [];
                            for (let el of pagesList.children) {
                                const name = el.querySelector('.page-name').textContent;
                                const page = section.pages.find(p => p.name === name);
                                if (page) newOrder.push(page);
                            }
                            section.pages = newOrder;
                            autoSave();
                        }
                    });
                }
            });
        }

        function renderContent() {
            const contentArea = document.getElementById('contentArea');
            const pageTitle = document.getElementById('pageTitle');

            if (!data.currentPage) {
                contentArea.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üé®</div>
                        <h2>Professional Loyiha Boshqaruvi</h2>
                        <p>Yangi bo'lim yarating va g'oyalaringizni hujjatlang<br>Yordam uchun <strong>H</strong> bosing</p>
                        <button class="btn btn-primary" onclick="createSection()">üöÄ Boshlash</button>
                    </div>
                `;
                pageTitle.textContent = 'IdeaFlow Ultimate';
                return;
            }

            pageTitle.textContent = data.currentPage.name;
            contentArea.innerHTML = '';

            data.currentPage.blocks.forEach(block => {
                const blockEl = createBlockElement(block);
                contentArea.appendChild(blockEl);
            });

            if (data.currentPage.blocks.length === 0) {
                contentArea.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìù</div>
                        <h2>Bo'sh Sahifa</h2>
                        <p>+ tugmasini bosing yoki klaviatura yorlig'ini ishlating</p>
                    </div>
                `;
            }
        }

        function createBlockElement(block) {
            const blockEl = document.createElement('div');
            blockEl.className = 'content-block';
            blockEl.dataset.blockId = block.id;

            const handle = document.createElement('div');
            handle.className = 'block-handle';
            handle.innerHTML = '‚ãÆ‚ãÆ';
            blockEl.appendChild(handle);

            const toolbar = document.createElement('div');
            toolbar.className = 'block-toolbar';
            toolbar.innerHTML = `
                <button class="toolbar-btn" onclick="duplicateBlock(${block.id})" title="Nusxa">üìã</button>
                <button class="toolbar-btn" onclick="deleteBlock(${block.id})" title="O'chirish">üóëÔ∏è</button>
            `;
            blockEl.appendChild(toolbar);

            let contentEl;
            switch (block.type) {
                case 'heading':
                    contentEl = document.createElement('div');
                    contentEl.className = 'block-content block-heading';
                    contentEl.contentEditable = true;
                    contentEl.textContent = block.content;
                    contentEl.oninput = (e) => updateBlockContent(block.id, e.target.textContent);
                    break;

                case 'text':
                    contentEl = document.createElement('div');
                    contentEl.className = 'block-content block-text';
                    contentEl.contentEditable = true;
                    
                    if (block.content && block.content.includes('**') || block.content.includes('*') || block.content.includes('#')) {
                        try {
                            contentEl.innerHTML = marked.parse(block.content);
                        } catch(e) {
                            contentEl.innerHTML = block.content;
                        }
                    } else {
                        contentEl.innerHTML = block.content;
                    }
                    
                    contentEl.oninput = (e) => updateBlockContent(block.id, e.target.innerHTML);
                    break;

                case 'list':
                    contentEl = document.createElement('div');
                    contentEl.className = 'block-content block-list';
                    contentEl.contentEditable = true;
                    contentEl.textContent = block.content;
                    contentEl.oninput = (e) => updateBlockContent(block.id, e.target.textContent);
                    break;

                case 'checklist':
                    contentEl = document.createElement('div');
                    contentEl.className = 'block-content block-checklist';
                    const items = JSON.parse(block.content || '[]');
                    items.forEach((item, index) => {
                        const itemEl = document.createElement('div');
                        itemEl.className = 'checklist-item';
                        itemEl.innerHTML = `
                            <div class="checklist-checkbox ${item.checked ? 'checked' : ''}" 
                                 onclick="toggleChecklistItem(${block.id}, ${index})"></div>
                            <div class="checklist-text ${item.checked ? 'completed' : ''}" 
                                 contenteditable="true"
                                 oninput="updateChecklistItem(${block.id}, ${index}, this.textContent)">${item.text}</div>
                        `;
                        contentEl.appendChild(itemEl);
                    });
                    break;

                case 'code':
                    contentEl = document.createElement('pre');
                    contentEl.className = 'block-content block-code';
                    contentEl.contentEditable = true;
                    
                    if (block.content && typeof hljs !== 'undefined') {
                        try {
                            const highlighted = hljs.highlightAuto(block.content);
                            contentEl.innerHTML = highlighted.value;
                        } catch(e) {
                            contentEl.textContent = block.content;
                        }
                    } else {
                        contentEl.textContent = block.content;
                    }
                    
                    contentEl.oninput = (e) => updateBlockContent(block.id, e.target.textContent);
                    break;

                case 'quote':
                    contentEl = document.createElement('blockquote');
                    contentEl.className = 'block-content block-quote';
                    contentEl.contentEditable = true;
                    contentEl.textContent = block.content;
                    contentEl.oninput = (e) => updateBlockContent(block.id, e.target.textContent);
                    break;

                case 'image':
                    contentEl = document.createElement('div');
                    contentEl.className = 'block-image';
                    if (block.content) {
                        contentEl.innerHTML = `<img src="${block.content}">`;
                    } else {
                        contentEl.innerHTML = `
                            <div class="image-placeholder">
                                <div class="image-placeholder-icon">üñºÔ∏è</div>
                                <div>Rasm yuklash uchun bosing</div>
                            </div>
                        `;
                    }
                    contentEl.onclick = () => uploadImage(block.id);
                    break;

                case 'table':
                    contentEl = document.createElement('div');
                    contentEl.className = 'block-content block-table';
                    contentEl.innerHTML = block.content;
                    break;

                case 'divider':
                    contentEl = document.createElement('div');
                    contentEl.className = 'block-divider';
                    break;
            }

            blockEl.appendChild(contentEl);

            if (contentEl.contentEditable) {
                contentEl.onfocus = () => blockEl.classList.add('focused');
                contentEl.onblur = () => blockEl.classList.remove('focused');
            }

            return blockEl;
        }

        function updateChecklistItem(blockId, itemIndex, text) {
            const block = data.currentPage.blocks.find(b => b.id === blockId);
            if (block && block.type === 'checklist') {
                const items = JSON.parse(block.content);
                items[itemIndex].text = text;
                block.content = JSON.stringify(items);
                autoSave();
            }
        }

        init();
    </script>
</body>
</html>